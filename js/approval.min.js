var $jscomp={scope:{},findInternal:function(b,a,c){b instanceof String&&(b=String(b));for(var e=b.length,d=0;d<e;d++){var f=b[d];if(a.call(c,f,d,b))return{i:d,v:f}}return{i:-1,v:void 0}}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(b,a,c){if(c.get||c.set)throw new TypeError("ES3 does not support getters and setters.");b!=Array.prototype&&b!=Object.prototype&&(b[a]=c.value)};
$jscomp.getGlobal=function(b){return"undefined"!=typeof window&&window===b?b:"undefined"!=typeof global&&null!=global?global:b};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(b,a,c,e){if(a){c=$jscomp.global;b=b.split(".");for(e=0;e<b.length-1;e++){var d=b[e];d in c||(c[d]={});c=c[d]}b=b[b.length-1];e=c[b];a=a(e);a!=e&&null!=a&&$jscomp.defineProperty(c,b,{configurable:!0,writable:!0,value:a})}};
$jscomp.polyfill("Array.prototype.find",function(b){return b?b:function(a,b){return $jscomp.findInternal(this,a,b).v}},"es6-impl","es3");
$(document).ready(function(){var b=getUrlParam();if(null!=b||""!=b)userId=JSON.parse('{"orderInDepts":"{6530723:69618531977482488}","position":"","remark":"","department":[6530723],"tel":"","unionid":"RKdLWiSoLRTaNx2yUDbmsZgiEiE","userid":"03424264076698","isSenior":false,"dingId":"$:LWCP_v1:$XjVQJF2K1NNTChUngjLuCA==","workPlace":"","isBoss":false,"name":"\u6881\u5f18\u626c","orgEmail":"yangholmes@exmail.qq.com","errmsg":"ok","stateCode":"86","avatar":"http://static.dingtalk.com/media/lADOp1YGhs0Bn80Bng_414_415.jpg","errcode":0,"jobnumber":"03424264076698","isLeaderInDepts":"{6530723:false}","email":"","roles":[{"id":100092577,"name":"\u5b50\u7ba1\u7406\u5458","groupName":"\u9ed8\u8ba4"}],"active":true,"isAdmin":true,"isHide":false,"mobile":"17098907535","openId":"RKdLWiSoLRTaNx2yUDbmsZgiEiE","deviceId":"45378c72524764608444090bdf41b850","admin_level":2,"emplId":"03424264076698"}').userid,getJson({resid:b})});
function getJson(b){$.ajax({url:"../server/reservation/reservation-load.php",dataType:"json",type:"POST",data:b,cache:!1,success:function(a){if(0==a.error){a=a.records.reservation[0];resStatus=a.status;"0"!=resStatus&&($(".td-approval-submit").css("display","none"),"1"==resStatus?$(".td-return-div").css("display","block"):"3"==resStatus&&($(".td-return-div").css("display","block"),$("#td-return-car")[0].textContent=a.returnDt));switch(a.usage){case "0":a.usage="\u51fa\u5dee";break;case "1":a.usage=
"\u63a5\u5f85";break;case "2":a.usage="\u5916\u52e4";break;case "3":a.usage="\u8f66\u8f86\u7ef4\u4fee";break;case "4":a.usage="\u5176\u4ed6"}a.plateNumber=a.car.plateNumber;a.model=a.car.model;a.driver=a.driver.name;a.name=a.applicant.name;$("#applicant-avatar").attr("src",a.applicant.avatar);null!=a&&""!=a&&$(".td-approval-container").setData(a);var b,e;$.each(a.approval,function(a,c){b="";console.log(c.comment);e=null!=c.comment?'style="display:block"':'style="display:none"';console.log(e);b+='<div class="cd-timeline-block"><div class="cd-timeline-img cd-picture"><img src="'+
c.approver.avatar+'" alt="Picture"></div><div class="cd-timeline-content"><div class="cd-timeline-name"><h2>'+c.approver.name+'</h2><div><span class="cd-date">'+c.operateDt+'</span></div></div><p class="approval-result" id="approval-result-'+a+'">'+c.result+'</p><p class="approval-comment"'+e+">"+c.comment+'</p><span class="approval-sequence">'+c.sequence+'</span><span class="approval-userid">'+c.userid+"</span></div></div>";$(".cd-container").append(b);var d=$("#approval-result-"+a);switch(c.result){case "0":d.text("\u672a\u5ba1\u6279");
break;case "1":d.text("\u5df2\u540c\u610f");d.css("color","green");break;case "2":d.text("\u5df2\u62d2\u7edd"),d.css("color","red")}})}else $.tdAlert("\u5f88\u9057\u61be\uff01\u52a0\u8f7d\u5931\u8d25");a=getApproval();-1==a?console.log("error!no approver or have pass!"):$(appDiv[a]).find(".approval-userid")[0].textContent!=userId&&$(".td-approval-submit").css("display","none")},error:function(a,b){$.tdAlert("\u5f88\u9057\u61be\uff01\u4f20\u9001\u9519\u8bef");console.log(a);console.log(b)}})}$("#td-agree-submit").click(function(b){setApproval("1")});
$("#td-disagree-submit").click(function(b){setApproval("2")});
function setApproval(b){var a=getApproval();-1==a?console.log("error!no approver!"):$.tdPrompt("",function(c,e){console.log(e);if(c){var d=$(appDiv[a]).find(".approval-sequence")[0].textContent,f=$(appDiv[a]).find(".cd-date")[0],d={sequence:d,resid:getUrlParam(),result:b,userid:userId,comment:e};showMask();$.ajax({url:"../server/approval/approve.php",type:"POST",data:d,cache:!1,success:function(c){c.error?$.tdAlert("\u4fee\u6539\u5ba1\u6279\u72b6\u6001\u5931\u8d25\uff01"+c.errorMsg):(f.textContent=
(new Date).toLocaleTimeString(),"1"==b?($(appDiv[a]).find(".approval-result")[0].textContent="\u5df2\u540c\u610f",$(appDiv[a]).find(".approval-result").css("color","green")):($(appDiv[a]).find(".approval-result")[0].textContent="\u5df2\u62d2\u7edd",$(appDiv[a]).find(".approval-result").css("color","red")),e&&($(appDiv[a]).find(".approval-comment").css("display","block"),$(appDiv[a]).find(".approval-comment")[0].textContent=e),$(".td-approval-submit").css("display","none"));$("#td-mask").hide()},error:function(){$.tdAlert("\u5f88\u9057\u61be\uff01\u5ba1\u6279\u5931\u8d25\uff01")},
xhr:function(){var a=new window.XMLHttpRequest;a.upload.addEventListener("progress",function(a){console.log(a.lengthComputable);a.lengthComputable&&100*a.loaded/a.total},!1);return a}})}},"\u5ba1\u6279\u610f\u89c1","\u8bf7\u8f93\u5165\u5ba1\u6279\u610f\u89c1\uff08\u53ef\u4ee5\u4e3a\u7a7a\uff09")}function getApproval(){appDiv=$("section>div");for(var b=-1,a=0;a<appDiv.length;a++)if("\u672a\u5ba1\u6279"==$(appDiv[a]).find(".approval-result")[0].textContent){b=a;break}return b}
$("#td-return-car").on("touchend",function(b){"3"!=resStatus&&(b={resid:getUrlParam(),userid:userId},showMask(),$.ajax({url:"../server/return/return.php",type:"POST",data:b,cache:!1,success:function(a){0==JSON.parse(a).error?($("#td-return-car")[0].textContent=JSON.parse(a).records.returnDt,$.tdAlert("\u8fd8\u8f66\u6210\u529f\uff01")):$.tdAlert("\u8fd8\u8f66\u5931\u8d25\uff01"+JSON.parse(a).errorMsg);$("#td-mask").hide()},error:function(){$.tdAlert("\u5f88\u9057\u61be\uff01\u8fd8\u8f66\u5931\u8d25\uff01")},
xhr:function(){var a=new window.XMLHttpRequest;a.upload.addEventListener("progress",function(a){console.log(a.lengthComputable);a.lengthComputable&&100*a.loaded/a.total},!1);return a}}))});$.fn.setData=function(b){var a=this,c;$.each(b,function(b,d){if(c=a.find("[id="+b+"]")[0])c.textContent=d})};function getUrlParam(){return decodeURI(document.URL).split("=")[1].split("&")[0]}
function showMask(){$("#td-mask").css("height",$(document).height());$("#td-mask").css("width",$(document).width());$("#td-mask").show();$("#td-mask img").show()};
