var $jscomp={scope:{},findInternal:function(a,b,c){a instanceof String&&(a=String(a));for(var e=a.length,d=0;d<e;d++){var f=a[d];if(b.call(c,f,d,a))return{i:d,v:f}}return{i:-1,v:void 0}}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(c.get||c.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};
$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(a,b,c,e){if(b){c=$jscomp.global;a=a.split(".");for(e=0;e<a.length-1;e++){var d=a[e];d in c||(c[d]={});c=c[d]}a=a[a.length-1];e=c[a];b=b(e);b!=e&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};
$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(b,a){return $jscomp.findInternal(this,b,a).v}},"es6-impl","es3");$(document).ready(function(){var a=localStorage.getItem("thisUser");a?"error"==a&&($("body").html(""),window.localStorage.removeItem("thisUser"),window.close()):window.location.href="http://www.gdrtc.org/dd-verification/index.php";var b=getUrlParam();if(null!=b||""!=b)userId=JSON.parse(a).userid,getJson({resid:b})});
function getJson(a){$.ajax({url:"../server/reservation/reservation-load.php",dataType:"json",type:"POST",data:a,cache:!1,success:function(a){if(0==a.error){var b=a.records.reservation[0];resStatus=b.status;carStatus=a.records.carStatus;reservation=b.id;"0"!=resStatus&&($(".td-approval-submit").css("display","none"),"1"==resStatus?$(".td-return-div").css("display","block"):"3"==resStatus&&($(".td-return-div").css("display","block"),$("#td-return-car")[0].textContent=b.returnDt));switch(b.usage){case "0":b.usage=
"\u51fa\u5dee";break;case "1":b.usage="\u63a5\u5f85";break;case "2":b.usage="\u5916\u52e4";break;case "3":b.usage="\u8f66\u8f86\u7ef4\u4fee";break;case "4":b.usage="\u5176\u4ed6"}carid=b.car.carid;b.plateNumber=b.car.plateNumber;b.model=b.car.model;b.driver=b.driver.name;b.name=b.applicant.name;$("#applicant-avatar").attr("src",b.applicant.avatar);null!=b&&""!=b&&$(".td-approval-container").setData(b);carStatus.length&&addCarStatus();var e,d;$.each(b.approval,function(b,a){e="";d=null!=a.comment?
'style="display:block"':'style="display:none"';e+='<div class="cd-timeline-block"><div class="cd-timeline-img cd-picture"><img src="'+a.approver.avatar+'" alt="Picture"></div><div class="cd-timeline-content"><div class="cd-timeline-name"><h2>'+a.approver.name+'</h2><div><span class="cd-date">'+a.operateDt+'</span></div></div><p class="approval-result" id="approval-result-'+b+'">'+a.result+'</p><p class="approval-comment"'+d+">"+a.comment+'</p><span class="approval-sequence">'+a.sequence+'</span><span class="approval-userid">'+
a.userid+"</span></div></div>";$(".cd-container").append(e);var c=$("#approval-result-"+b);switch(a.result){case "0":c.text("\u672a\u5ba1\u6279");break;case "1":c.text("\u5df2\u540c\u610f");c.css("color","green");break;case "2":c.text("\u5df2\u62d2\u7edd"),c.css("color","red")}})}else $.tdAlert("\u5f88\u9057\u61be\uff01\u52a0\u8f7d\u5931\u8d25");a=getApproval();-1==a?console.log("error!no approver or have pass!"):$(appDiv[a]).find(".approval-userid")[0].textContent!=userId&&$(".td-approval-submit").css("display",
"none")},error:function(b,a){$.tdAlert("\u5f88\u9057\u61be\uff01\u4f20\u9001\u9519\u8bef");console.log(b);console.log(a)}})}$("#td-agree-submit").click(function(a){setApproval("1")});$("#td-disagree-submit").click(function(a){setApproval("2")});
function setApproval(a){var b=getApproval();-1==b?console.log("error!no approver!"):$.tdPrompt("",function(c,e){if(c){var d=$(appDiv[b]).find(".approval-sequence")[0].textContent,f=$(appDiv[b]).find(".cd-date")[0],d={sequence:d,resid:getUrlParam(),result:a,userid:userId,comment:e};showMask();$.ajax({url:"../server/approval/approve.php",type:"POST",data:d,cache:!1,success:function(c){c.error?$.tdAlert("\u4fee\u6539\u5ba1\u6279\u72b6\u6001\u5931\u8d25\uff01"+c.errorMsg):(f.textContent=(new Date).toLocaleTimeString(),
"1"==a?($(appDiv[b]).find(".approval-result")[0].textContent="\u5df2\u540c\u610f",$(appDiv[b]).find(".approval-result").css("color","green")):($(appDiv[b]).find(".approval-result")[0].textContent="\u5df2\u62d2\u7edd",$(appDiv[b]).find(".approval-result").css("color","red")),e&&($(appDiv[b]).find(".approval-comment").css("display","block"),$(appDiv[b]).find(".approval-comment")[0].textContent=e),$(".td-approval-submit").css("display","none"));$("#td-mask").hide()},error:function(b,a){$.tdAlert("\u5f88\u9057\u61be\uff01\u5ba1\u6279\u5931\u8d25\uff01");
console.log(b);console.log(a)}})}},"\u5ba1\u6279\u610f\u89c1","\u8bf7\u8f93\u5165\u5ba1\u6279\u610f\u89c1\uff08\u53ef\u4ee5\u4e3a\u7a7a\uff09")}function getApproval(){appDiv=$("section>div");for(var a=-1,b=0;b<appDiv.length;b++)if("\u672a\u5ba1\u6279"==$(appDiv[b]).find(".approval-result")[0].textContent){a=b;break}return a}
$("#td-return-car").on("touchend",function(a){"3"!=resStatus&&(0<carStatus.length?(a={resid:getUrlParam(),userid:userId},showMask(),$.ajax({url:"../server/return/return.php",type:"POST",data:a,cache:!1,success:function(b){0==JSON.parse(b).error?($("#td-return-car")[0].textContent=JSON.parse(b).records.returnDt,$.tdAlert("\u8fd8\u8f66\u6210\u529f\uff01")):$.tdAlert("\u8fd8\u8f66\u5931\u8d25\uff01"+JSON.parse(b).errorMsg);$("#td-mask").hide()},error:function(b,a){$.tdAlert("\u5f88\u9057\u61be\uff01\u8fd8\u8f66\u5931\u8d25\uff01");
console.log(b);console.log(a)}})):(showMask(),$("#mask-return-div").show()))});$("#return-title-close").on("touchend",function(a){$("#td-mask").hide()});
$("form").submit(function(a){a=$("form #damageType")[0].value;var b=$("form #damageDetails")[0].value,c=$("form #unitollGD")[0].value;if(!/^\d+(\.{0,1}\d+){0,1}$/.test(c))return $.tdAlert("\u8bf7\u8f93\u5165\u683c\u5f0f\u6b63\u786e\u7684\u5269\u4f59\u91d1\u989d\uff01(\u91d1\u989d\u5e94\u4e3a\u975e\u8d1f\u6570)"),!1;if("0"!=a&&!b)return $.tdAlert("\u8f66\u8f86\u82e5\u6709\u635f\u4f24\uff0c\u8bf7\u586b\u5199\u8be6\u60c5~"),!1;a={carid:carid,reservation:reservation,fuelIndicator:parseInt($("form #fuelIndicator")[0].value),
unitollGD:c,damageType:parseInt(a),damageDetails:b};$("#mask-return-div").hide();$.ajax({url:"../server/car-management/car-status-update.php",type:"POST",data:a,cache:!1,success:function(a){0==JSON.parse(a).error?(carStatus.push(JSON.parse(a).records),addCarStatus(),$.tdAlert("\u7533\u8bf7\u8fd8\u8f66\u6210\u529f\uff01")):$.tdAlert("\u7533\u8bf7\u5931\u8d25\uff01"+JSON.parse(a).errorMsg);$("#td-mask").hide()},error:function(a,b){$.tdAlert("\u5f88\u9057\u61be\uff01\u7533\u8bf7\u8fd8\u8f66\u5931\u8d25\uff01\u8bf7\u5237\u65b0\u91cd\u8bd5");
console.log(a);console.log(b)}});return!1});$.fn.setData=function(a){var b=this,c;$.each(a,function(a,d){if(c=b.find("[id="+a+"]")[0])c.textContent=d})};
function addCarStatus(){var a=carStatus[0].fuelIndicator+"%",b;switch(carStatus[0].damageType){case "0":b="\u65e0";break;case "1":b="\u8f66\u8eab\u635f\u4f24";break;case "2":b="\u96f6\u90e8\u4ef6\u635f\u574f";break;case "3":b="\u8bbe\u5907\u635f\u574f";break;case "4":b="\u5176\u4ed6";break;default:b=""}a='<tr><td class="table-left">\u5269\u4f59\u6cb9\u91cf\uff1a</td><td id="fuelIndicator">'+a+'</td></tr><tr><td class="table-left">\u7ca4\u901a\u5361\uff1a</td><td id="unitollGD">'+carStatus[0].unitollGD+
'\u5143</td></tr><tr><td class="table-left">\u8f66\u8f86\u72b6\u51b5\uff1a</td><td id="damageType">'+b+'</td></tr><tr><td class="table-left">\u635f\u574f\u8be6\u60c5\uff1a</td><td id="damageDetails">'+carStatus[0].damageDetails+"</td></tr>";$(".td-detial-table").append(a)}function getUrlParam(){return decodeURI(document.URL).split("=")[1].split("&")[0]}
function showMask(){$("#td-mask").css("height",$(document).height());$("#td-mask").css("width",$(document).width());$("#td-mask").show();$("#td-mask i.fa").show()};
