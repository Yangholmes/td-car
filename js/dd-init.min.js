var _user={},_config=_config;dd.config({agentId:_config.agentId[0],corpId:_config.corpId[0],timeStamp:_config.timeStamp,nonceStr:_config.nonceStr,signature:_config.signature,type:0,jsApiList:["runtime.info","biz.contact.choose","device.notification.confirm","device.notification.alert","device.notification.prompt","biz.ding.post","biz.util.openLink","ui.pullToRefresh.enable","ui.pullToRefresh.stop","biz.util.openLink","biz.navigation.setLeft","biz.navigation.setTitle","biz.navigation.setRight"]});dd.ready(function(){dd.runtime.info({onSuccess:function(a){console.log("runtime info: "+JSON.stringify(a))},onFail:function(a){console.log("fail: "+JSON.stringify(a))}});dd.runtime.permission.requestAuthCode({corpId:_config.corpId[0],onSuccess:function(a){console.log("微应用免登授权码: ",a);$.ajax({url:"server/verification/get-user-info.php?access_token="+_config.accessToken+"&code="+a.code,method:"GET",dataType:"json",success:function(b){console.log(b);_user=b},error:function(){}})},onFail:function(a){console.log("微应用免登授权码, 错误: ",a)}});dd.ui.pullToRefresh.disable();dd.biz.navigation.setTitle({title:"通导用车",onSuccess:function(a){console.log(a)},onFail:function(a){console.log(JSON.stringify(a))}});dd.biz.navigation.setMenu({items:[{id:"1",text:"我的历史",},{id:"2",text:"车的管理",},{id:"3",text:"添加车辆",},{id:"4",text:"还车记录",}],onSuccess:function(a){switch(a.id){case"1":dd.biz.util.openLink({url:"http://www.gdrtc.org/car/page/personal-history.html",onSuccess:function(b){},onFail:function(){}});break;case"2":if(_user.admin_level=="0"){$.tdAlert("这个操作需要管理员权限");return false}dd.biz.util.openLink({url:"http://www.gdrtc.org/car/page/car.html",onSuccess:function(b){},onFail:function(){}});break;case"3":if(_user.admin_level=="0"){$.tdAlert("这个操作需要管理员权限");return false}dd.biz.util.openLink({url:"http://www.gdrtc.org/car/page/car-add.html?userid="+_user.userid,onSuccess:function(b){},onFail:function(){}});break;case"4":dd.biz.util.openLink({url:"http://www.gdrtc.org/car/page/car-history.html",onSuccess:function(b){},onFail:function(){}});break;default:break}},onFail:function(a){$.tdAlert(a)}})});dd.error(function(a){console.log("错误信息: "+JSON.stringify(a));$.tdAlert("错误信息: 钉钉验证失败，请重试")});