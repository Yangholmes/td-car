var _user={};$(function(){var a=localStorage.getItem("thisUser");if(!a)window.location.href="http://www.gdrtc.org/dd-verification/index.php";else if("error"==a)return window.localStorage.removeItem("thisUser"),window.close(),!1;_user=JSON.parse(a);renderPersonalInfo();scrollToLoad()});
var renderPersonalInfo=function(){$.ajax({url:"../server/reservation/personal-history-init.php",dataType:"json",type:"POST",data:{user:_user.userid,department:_user.department.filter(function(a){if(1!=a)return a})},cache:!1,success:function(a){var b=a.reservationSum,b='\n            <div class="personnal-avatar"><img alt="\u5e05\u7167" src="'+_user.avatar+'"></div>\n            <div class="personal-overall-info">\n              <div class="personal-info-name-department"><span class="personal-info-name">'+
_user.name+'</span><span class="personal-info-department">'+a.department.join(",")+'</span></div>\n              <div class="personal-info-sum">\u4e00\u5171\u501f\u8f66<span>'+b+"</span>\u6b21</div>\n            </div>\n          ";$("header.personal-info").html(b);renderReservationInfo(a.reservation)},error:function(){$("header.personal-info").html("\u901a\u4fe1\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5")}})},renderReservationInfo=function(a){a.forEach(function(a,c,d){a='\n    <li>\n        <div class="car-img"><img alt="awesome car" src="'+
a.carImageSrc+'"><div class="car-model">'+a.carModel+'</div></div>\n        <div class="reservation-info-detail">\n          <p><label>\u51fa\u53d1\u5730\u70b9:</label><span>'+a.startpoint+"</span></p>\n          <p><label>\u76ee\u7684\u5730\u70b9:</label><span>"+a.endpoint+"</span></p>\n          <p><label>\u9884\u8ba1\u51fa\u53d1:</label><span>"+a["schedule-start"]+"</span></p>\n          <p><label>\u9884\u8ba1\u8fd4\u56de:</label><span>"+a["schedule-end"]+"</span></p>\n          <p><label>\u5f52\u8fd8\u65f6\u95f4:</label><span>"+
a.returnDt+"</span></p>\n          <p><label>\u53f8\u673a:</label><span>"+a.driver+"</span></p>\n          <p><label>\u540c\u884c\u4eba\u5458:</label><span>"+a.accompanist+"</span></p>\n        </div>\n    </li>\n    ";$("ul.reservation-list div.pull-up-tip").before(a)})},loadmoreEnable=!1,loadmoreMoveEnable=!1,psitionY=0,deltaY=0,scrollToLoad=function(){$(window).on("scroll",function(a){console.log($(window).scrollTop(),$(document).height()-$("body").height());loadmoreEnable=$(window).scrollTop()>=
$(document).height()-$("body").height()-50?!0:!1});$("main").on("touchstart",function(a){loadmoreEnable&&(loadmoreMoveEnable=!0,positionY=a.changedTouches[0].clientY,$("ul.reservation-list div.pull-up-tip p").html("\u677e\u5f00\u52a0\u8f7d"))});$("main").on("touchmove",function(a){loadmoreEnable&&loadmoreMoveEnable&&(a.preventDefault(),deltaY=a.changedTouches[0].clientY-positionY,$("ul.reservation-list").css("transform","translateY("+deltaY+"px)"))});$("main").on("touchend",function(a){loadmoreEnable&&
loadmoreMoveEnable&&(deltaY=a.changedTouches[0].clientY-positionY,loadmore(deltaY))})},offset=1,loadmore=function(a){$("ul.reservation-list div.pull-up-tip p").html("\u52a0\u8f7d\u4e2d\u2026\u2026");loadmoreMoveEnable=loadmoreEnable=!1;positionY=deltaY=0;var b=setInterval(function(){0<a?a=0:0==a?clearInterval(b):a+=10;$("ul.reservation-list").css("transform","translateY("+a+"px)")},10);$.ajax({url:"../server/reservation/personal-history-retrieve.php",dataType:"json",type:"POST",data:{user:_user.userid,
offset:5*offset},cache:!1,success:function(a){renderReservationInfo(a.reservation);$("ul.reservation-list div.pull-up-tip p").html("\u4e0a\u62c9\u52a0\u8f7d\u66f4\u591a");a.reservation.length?offset++:$("ul.reservation-list div.pull-up-tip p").html("\u5168\u90e8\u52a0\u8f7d\u5b8c\u6bd5")},error:function(a){$("ul.reservation-list div.pull-up-tip p").html("\u52a0\u8f7d\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5")}})};
